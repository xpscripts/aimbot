

-- XP;Scripts
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

-- Local player and camera
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- Control variables
local espEnabled = false
local aimbotEnabled = false
local teamCheck = false
local wallCheck = false
local glowEnabled = false     -- New: control for the glow effect
local targetPart = "Head"
local fovRadius = 150
local showFov = false
local fovRainbow = false
local espObjects = {}
local glowObjects = {}        -- New: objects for the glow effect
local hue = 0
local smoothingFactor = 0.5   -- New: aimbot smoothing (0-1)

-- Colors and styles
local COLORS = {
    PRIMARY = Color3.fromRGB(25, 25, 25),
    SECONDARY = Color3.fromRGB(35, 35, 35),
    ACCENT = Color3.fromRGB(255, 200, 0),
    ENABLED = Color3.fromRGB(0, 200, 0),
    DISABLED = Color3.fromRGB(200, 0, 0),
    TEXT = Color3.fromRGB(255, 255, 255)
}

-- UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ESP_UI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Protection against detection
pcall(function()
    if syn then
        syn.protect_gui(ScreenGui)
        ScreenGui.Parent = game.CoreGui
    else
        ScreenGui.Parent = game.CoreGui
    end
end)

-- Main frame with shadow and rounding
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 250, 0, 430)
MainFrame.Position = UDim2.new(0, 20, 0, 100)
MainFrame.BackgroundColor3 = COLORS.PRIMARY
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundTransparency = 0.1
MainFrame.Active = true
MainFrame.Draggable = true

-- Shadow effect
local Shadow = Instance.new("ImageLabel", MainFrame)
Shadow.Size = UDim2.new(1, 30, 1, 30)
Shadow.Position = UDim2.new(0, -15, 0, -15)
Shadow.BackgroundTransparency = 1
Shadow.Image = "rbxassetid://5028857084"
Shadow.ImageColor3 = Color3.new(0, 0, 0)
Shadow.ScaleType = Enum.ScaleType.Slice
Shadow.SliceCenter = Rect.new(24, 24, 276, 276)
Shadow.ImageTransparency = 0.5
Shadow.ZIndex = 0

-- Title bar
local TitleBar = Instance.new("Frame", MainFrame)
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = COLORS.ACCENT
TitleBar.BorderSizePixel = 0

-- Title
local Title = Instance.new("TextLabel", TitleBar)
Title.Text = "XP;Scripts"
Title.Size = UDim2.new(1, -10, 1, 0)
Title.Position = UDim2.new(0, 5, 0, 0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.new(0, 0, 0)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left

-- Content area
local ContentFrame = Instance.new("Frame", MainFrame)
ContentFrame.Size = UDim2.new(1, -20, 1, -50)
ContentFrame.Position = UDim2.new(0, 10, 0, 45)
ContentFrame.BackgroundTransparency = 1
ContentFrame.BorderSizePixel = 0

local UIListLayout = Instance.new("UIListLayout", ContentFrame)
UIListLayout.Padding = UDim.new(0, 8)
UIListLayout.FillDirection = Enum.FillDirection.Vertical
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Top

-- Function to create sections
local function createSection(name)
    local section = Instance.new("Frame", ContentFrame)
    section.Size = UDim2.new(1, 0, 0, 25)
    section.BackgroundTransparency = 1

    local label = Instance.new("TextLabel", section)
    label.Text = name
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = COLORS.ACCENT
    label.Font = Enum.Font.GothamSemibold
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left

    return section
end

-- Toggle button function with state and hover effect
local function createToggleButton(name, getState, onToggle)
    local button = Instance.new("Frame", ContentFrame)
    button.Size = UDim2.new(1, 0, 0, 35)
    button.BackgroundColor3 = COLORS.SECONDARY
    button.BorderSizePixel = 0

    local UICorner = Instance.new("UICorner", button)
    UICorner.CornerRadius = UDim.new(0, 6)

    local statusIndicator = Instance.new("Frame", button)
    statusIndicator.Size = UDim2.new(0, 16, 0, 16)
    statusIndicator.Position = UDim2.new(0, 10, 0.5, -8)
    statusIndicator.BorderSizePixel = 0

    local statusCorner = Instance.new("UICorner", statusIndicator)
    statusCorner.CornerRadius = UDim.new(0, 8)

    local label = Instance.new("TextLabel", button)
    label.Text = name
    label.Size = UDim2.new(1, -40, 1, 0)
    label.Position = UDim2.new(0, 35, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = COLORS.TEXT
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left

    local hitBox = Instance.new("TextButton", button)
    hitBox.Size = UDim2.new(1, 0, 1, 0)
    hitBox.BackgroundTransparency = 1
    hitBox.Text = ""

    local function updateColor()
        local enabled = getState()
        statusIndicator.BackgroundColor3 = enabled and COLORS.ENABLED or COLORS.DISABLED
    end

    hitBox.MouseButton1Click:Connect(function()
        onToggle()
        updateColor()
    end)

    -- Hover effects
    hitBox.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end)

    hitBox.MouseLeave:Connect(function()
        button.BackgroundColor3 = COLORS.SECONDARY
    end)

    updateColor()
    return button
end

-- Slider function
local function createSlider(name, min, max, default, onChanged)
    local sliderContainer = Instance.new("Frame", ContentFrame)
    sliderContainer.Size = UDim2.new(1, 0, 0, 50)
    sliderContainer.BackgroundColor3 = COLORS.SECONDARY
    sliderContainer.BorderSizePixel = 0

    local UICorner = Instance.new("UICorner", sliderContainer)
    UICorner.CornerRadius = UDim.new(0, 6)

    local label = Instance.new("TextLabel", sliderContainer)
    label.Text = name .. ": " .. default
    label.Size = UDim2.new(1, -20, 0, 20)
    label.Position = UDim2.new(0, 10, 0, 5)
    label.BackgroundTransparency = 1
    label.TextColor3 = COLORS.TEXT
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left

    local sliderBg = Instance.new("Frame", sliderContainer)
    sliderBg.Size = UDim2.new(1, -20, 0, 6)
    sliderBg.Position = UDim2.new(0, 10, 0, 30)
    sliderBg.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    sliderBg.BorderSizePixel = 0

    local sliderBgCorner = Instance.new("UICorner", sliderBg)
    sliderBgCorner.CornerRadius = UDim.new(0, 3)

    local sliderFill = Instance.new("Frame", sliderBg)
    sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    sliderFill.BackgroundColor3 = COLORS.ACCENT
    sliderFill.BorderSizePixel = 0

    local sliderFillCorner = Instance.new("UICorner", sliderFill)
    sliderFillCorner.CornerRadius = UDim.new(0, 3)

    local sliderButton = Instance.new("TextButton", sliderBg)
    sliderButton.Size = UDim2.new(1, 0, 1, 0)
    sliderButton.BackgroundTransparency = 1
    sliderButton.Text = ""

    local currentValue = default

    local function updateSlider(input)
        local pos = math.clamp((input.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
        local value = math.floor(min + (max - min) * pos)
        currentValue = value
        sliderFill.Size = UDim2.new(pos, 0, 1, 0)
        label.Text = name .. ": " .. value
        onChanged(value)
    end

    sliderButton.MouseButton1Down:Connect(function()
        local input = UserInputService.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement then
                updateSlider(input)
            end
        end)

        UserInputService.InputEnded:Connect(function(inputObject)
            if inputObject.UserInputType == Enum.UserInputType.MouseButton1 then
                input:Disconnect()
            end
        end)
    end)

    return sliderContainer, function() return currentValue end
end

-- Selector function
local function createSelector(name, options, default, onChanged)
    local selector = Instance.new("Frame", ContentFrame)
    selector.Size = UDim2.new(1, 0, 0, 35)
    selector.BackgroundColor3 = COLORS.SECONDARY
    selector.BorderSizePixel = 0

    local UICorner = Instance.new("UICorner", selector)
    UICorner.CornerRadius = UDim.new(0, 6)

    local label = Instance.new("TextLabel", selector)
    label.Text = name .. ": " .. options[default]
    label.Size = UDim2.new(1, -80, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = COLORS.TEXT
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left

    local nextButton = Instance.new("TextButton", selector)
    nextButton.Size = UDim2.new(0, 60, 0, 25)
    nextButton.Position = UDim2.new(1, -70, 0.5, -12.5)
    nextButton.BackgroundColor3 = COLORS.ACCENT
    nextButton.BorderSizePixel = 0
    nextButton.Text = "Change"
    nextButton.TextColor3 = Color3.new(0, 0, 0)
    nextButton.Font = Enum.Font.GothamSemibold
    nextButton.TextSize = 14

    local nextButtonCorner = Instance.new("UICorner", nextButton)
    nextButtonCorner.CornerRadius = UDim.new(0, 4)

    local currentIndex = default

    nextButton.MouseButton1Click:Connect(function()
        currentIndex = currentIndex % #options + 1
        label.Text = name .. ": " .. options[currentIndex]
        onChanged(options[currentIndex])
    end)

    -- Hover effects
    nextButton.MouseEnter:Connect(function()
        nextButton.BackgroundColor3 = Color3.fromRGB(255, 220, 50)
    end)

    nextButton.MouseLeave:Connect(function()
        nextButton.BackgroundColor3 = COLORS.ACCENT
    end)

    return selector
end

-- UI sections
createSection("VISUALS")

-- ESP buttons
createToggleButton("ESP", function() return espEnabled end, function() espEnabled = not espEnabled end)
createToggleButton("ESP Glow", function() return glowEnabled end, function() glowEnabled = not glowEnabled end)
createToggleButton("Team Check", function() return teamCheck end, function() teamCheck = not teamCheck end)
createToggleButton("Wall Check", function() return wallCheck end, function() wallCheck = not wallCheck end)

createSection("AIMBOT")

-- Aimbot buttons
createToggleButton("Aimbot", function() return aimbotEnabled end, function() aimbotEnabled = not aimbotEnabled end)
createToggleButton("Show FOV", function() return showFov end, function() showFov = not showFov end)
createToggleButton("FOV Rainbow", function() return fovRainbow end, function() fovRainbow = not fovRainbow end)

-- Slider for FOV
local fovSlider, getFov = createSlider("FOV", 50, 500, fovRadius, function(value)
    fovRadius = value
    if fovCircle then
        fovCircle.Radius = value
    end
end)

-- Slider for aimbot smoothing
local smoothSlider = createSlider("Aimbot Smoothing", 0, 10, smoothingFactor * 10, function(value)
    smoothingFactor = value / 10
end)

-- Target part selector
createSelector("Target Part", {"Head", "HumanoidRootPart", "Torso"}, 1, function(value)
    targetPart = value
end)

-- Glow effect
local function updateGlowForPlayer(player)
    if not glowEnabled or not espEnabled then
        if glowObjects[player] then
            for _, highlighter in pairs(glowObjects[player]) do
                highlighter:Destroy()
            end
            glowObjects[player] = nil
        end
        return
    end

    if player == LocalPlayer then return end
    if teamCheck and player.Team == LocalPlayer.Team then return end

    local character = player.Character
    if not character then return end

    if not glowObjects[player] then
        glowObjects[player] = {}
    end

    -- Clear old highlighters
    for _, highlighter in pairs(glowObjects[player]) do
        highlighter:Destroy()
    end
    glowObjects[player] = {}

    -- Add new highlighters
    for _, part in pairs(character:GetChildren()) do
        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
            -- Determine glow color based on team
            local glowColor = player.Team == LocalPlayer.Team and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)

            -- Create the highlighter
            local highlighter = Instance.new("Highlight")
            highlighter.Name = "ESPHighlight"
            highlighter.FillColor = glowColor
            highlighter.OutlineColor = glowColor
            highlighter.FillTransparency = 0.7
            highlighter.OutlineTransparency = 0
            highlighter.Adornee = part
            highlighter.Parent = game.CoreGui

            table.insert(glowObjects[player], highlighter)
        end
    end
end

-- FOV Circle
local fovCircle = Drawing.new("Circle")
fovCircle.Visible = showFov
fovCircle.Thickness = 2
fovCircle.Radius = fovRadius
fovCircle.Transparency = 1
fovCircle.Color = Color3.new(1, 1, 1)
fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

-- ESP
local function createESP(player)
    if player == LocalPlayer or espObjects[player] then return end

    -- ESP box
    local box = Drawing.new("Square")
    box.Visible = false
    box.Color = Color3.new(1, 1, 1)
    box.Thickness
